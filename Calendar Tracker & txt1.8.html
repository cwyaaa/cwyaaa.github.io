<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>打卡日历与工作记录</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .main-container {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }
    /* 左侧：月份输入区域 */
    .input-section {
      flex: 0 0 150px;
      border: 1px solid #ccc;
      padding: 10px;
    }
    /* 中间：日历区域（上下排列连续两个月） */
    .calendar-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    /* 右侧：工作记录区域 */
    .record-section {
      flex: 0 0 300px;
      border: 1px solid #ccc;
      padding: 10px;
    }
    /* 日历样式 */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 50px;
      gap: 5px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .month {
      grid-column: span 7;
      font-size: 18px;
      text-align: center;
      line-height: 50px;
      background: #f0f0f0;
    }
    .calendar div.day-cell {
      text-align: center;
      line-height: 50px;
      border: 1px solid #ccc;
      cursor: pointer;
      border-radius: 10px; /* 圆角 */
    }
    .calendar div.day-cell:hover {
      background-color: #ddd;
    }
    /* 被点击的日期始终保留绿色背景 */
    .calendar div.day-cell.selected {
      background-color: #4CAF50;
      color: #fff;
    }
    /* 当前正在编辑的日期，加上红色边框 */
    .calendar div.day-cell.current {
      border: 2px solid red;
    }
    input, button, textarea {
      padding: 5px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    textarea {
      width: 100%;
      box-sizing: border-box;
    }
    button {
      cursor: pointer;
    }
    .notes {
      margin-top: 10px;
      padding: 5px;
      background-color: #f9f9f9;
      border: 1px solid #ccc;
    }
    .notes h3 {
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- 左侧：输入月份 -->
    <div class="input-section">
      <h2>输入月份</h2>
      <input type="number" id="monthInput" min="1" max="12" placeholder="1-12">
      <br>
      <button onclick="generateCalendars()">生成日历</button>
    </div>
    <!-- 中间：连续两个月的日历 -->
    <div class="calendar-section">
      <div class="calendar" id="calendar1"></div>
      <div class="calendar" id="calendar2"></div>
    </div>
    <!-- 右侧：工作记录 -->
    <div class="record-section">
      <h2>工作记录</h2>
      <div id="recordDate">当前选择日期: 无</div>
      <textarea id="recordInput" rows="10" placeholder="输入工作记录..."></textarea>
      <br>
      <button onclick="saveRecord()">保存记录</button>

      <!-- 新增备注区域 -->
      <div class="notes" id="notesSection">
        <h3>备注</h3>
        <p id="notesText">没有记录。</p>
      </div>
    </div>
  </div>

  <script>
    // 用于存放各日期的工作记录，键为 "YYYY-MM-DD"
    let workRecords = {};
    // 当前选中的日期（格式 "YYYY-MM-DD"）
    let selectedDate = null;
    // 当前正在编辑的日期所在的单元格
    let currentCell = null;

    // 格式化日期为 YYYY-MM-DD
    function formatDate(year, month, day) {
      return year + '-' + String(month + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
    }

    /**
     * 创建指定年月的日历，并显示在指定容器中
     * @param {number} year - 年份
     * @param {number} month - 月份（0-11）
     * @param {string} calendarId - 日历容器的ID
     */
    function createCalendar(year, month, calendarId) {
      const monthNames = ["January", "February", "March", "April", "May", "June",
                          "July", "August", "September", "October", "November", "December"];
      const calendarDiv = document.getElementById(calendarId);
      calendarDiv.innerHTML = "";  // 清空上次生成的内容

      // 添加月份标题（跨7列显示）
      const monthHeader = document.createElement('div');
      monthHeader.className = 'month';
      monthHeader.textContent = `${monthNames[month]} ${year}`;
      calendarDiv.appendChild(monthHeader);

      // 当月1日星期几（0-6，0为星期日）
      const firstDay = new Date(year, month, 1).getDay();
      // 当月总天数
      const lastDate = new Date(year, month + 1, 0).getDate();

      // 添加前置空格（占位）
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        calendarDiv.appendChild(emptyCell);
      }

      // 添加日期格子
      for (let day = 1; day <= lastDate; day++) {
        const dayCell = document.createElement('div');
        dayCell.textContent = day;
        dayCell.classList.add("day-cell");
        dayCell.addEventListener('click', function() {
          // 为当前单元格添加当前编辑状态，并移除其他单元格的当前编辑状态
          if (currentCell) {
            currentCell.classList.remove('current');
          }
          currentCell = dayCell;
          dayCell.classList.add('current');

          // 生成日期字符串
          const dateKey = formatDate(year, month, day);
          // 判断是否已经选中
          if (dayCell.classList.contains('selected')) {
            // 如果已经选中，则移除绿色背景
            dayCell.classList.remove('selected');
            // 取消当前日期
            selectedDate = null;
            document.getElementById('recordDate').textContent = "当前选择日期: 无";
            document.getElementById('recordInput').value = "";
            document.getElementById('notesText').textContent = "没有记录。";
          } else {
            // 标记该日期为已打卡状态（绿色背景）
            dayCell.classList.add('selected');
            // 更新全局变量selectedDate
            selectedDate = dateKey;
            document.getElementById('recordDate').textContent = "当前选择日期: " + dateKey;
            // 显示已有的工作记录，如果没有则为空
            document.getElementById('recordInput').value = workRecords[dateKey] || "";
            // 更新备注区内容
            document.getElementById('notesText').textContent = workRecords[dateKey] ? workRecords[dateKey] : "没有记录。";
          }
        });
        calendarDiv.appendChild(dayCell);
      }
    }

    /**
     * 根据输入的月份生成对应日历和下一个月日历
     */
    function generateCalendars() {
      const monthInputValue = document.getElementById('monthInput').value;
      const monthNum = parseInt(monthInputValue, 10);
      const currentYear = new Date().getFullYear();

      if (isNaN(monthNum) || monthNum < 1 || monthNum > 12) {
        alert("请输入有效的月份（1-12）");
        return;
      }
      // 生成输入月份的日历（JavaScript中月份从0开始）
      createCalendar(currentYear, monthNum - 1, 'calendar1');

      // 计算下一个月（12月则为明年1月）
      let nextMonth = monthNum === 12 ? 1 : monthNum + 1;
      let nextYear = monthNum === 12 ? currentYear + 1 : currentYear;
      createCalendar(nextYear, nextMonth - 1, 'calendar2');

      // 保存月份到 localStorage
      localStorage.setItem("selectedMonth", monthNum);

      // 重置工作记录显示区
      selectedDate = null;
      currentCell = null;
      document.getElementById('recordDate').textContent = "当前选择日期: 无";
      document.getElementById('recordInput').value = "";
      document.getElementById('notesText').textContent = "没有记录。";
    }

    /**
     * 保存当前选中日期的工作记录
     */
    function saveRecord() {
      if (!selectedDate) {
        alert("请先选择一个日期！");
        return;
      }
      const recordText = document.getElementById('recordInput').value;
      workRecords[selectedDate] = recordText;
      localStorage.setItem('workRecords', JSON.stringify(workRecords)); // 保存记录到 localStorage
      alert("记录已保存！");
      
      // 更新备注区
      document.getElementById('notesText').textContent = recordText || "没有记录。";
    }

    // 页面加载时恢复上次的月份和日历
    window.onload = function() {
      const savedMonth = localStorage.getItem("selectedMonth");
      if (savedMonth) {
        document.getElementById("monthInput").value = savedMonth;
        generateCalendars();  // 生成并显示保存的月份的日历
      }

      // 加载保存的工作记录
      const savedWorkRecords = localStorage.getItem('workRecords');
      if (savedWorkRecords) {
        workRecords = JSON.parse(savedWorkRecords);
      }
    };
  </script>
</body>
</html>
